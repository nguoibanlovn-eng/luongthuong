<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Phần mềm chia thưởng nhân sự</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; }
    h1, h2 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 13px; }
    th, td { border: 1px solid #ccc; padding: 4px 6px; text-align: center; }
    input[type="number"] { width: 100%; box-sizing: border-box; font-size: 12px; }
    input[type="text"] { width: 100%; box-sizing: border-box; font-size: 12px; }
    .btn { padding: 6px 10px; margin: 8px 0; cursor: pointer; }
    tfoot td { font-weight: bold; background: #f5f5f5; }
  </style>
</head>
<body>
  <h1>Tool tính thưởng theo kênh & bộ phận</h1>

  <h2>1. Hòa vốn – Lợi nhuận – Thưởng theo kênh</h2>
  <p>Nhập doanh thu, chi phí cố định, tỷ lệ chi phí (%) và tỷ lệ chia thưởng trên <b>biên lợi nhuận</b>.</p>

  <table id="mainTable">
    <thead>
      <tr>
        <th>Kênh</th>
        <th>Doanh thu (VND)</th>
        <th>Chi phí cố định (VND)</th>
        <th>CP bán hàng %</th>
        <th>Giá vốn %</th>
        <th>CP khác %</th>
        <th>Tổng biến phí %</th>
        <th>Lợi nhuận (VND)</th>
        <th>Tỉ suất LN (LN/DT)</th>
        <th>Doanh thu hòa vốn</th>
        <th>Sale % trên tỉ suất</th>
        <th>Thưởng Sale</th>
        <th>RD % trên tỉ suất</th>
        <th>Thưởng RD</th>
        <th>CSKH % trên tỉ suất</th>
        <th>Thưởng CSKH</th>
        <th>KT+HCNS % trên tỉ suất</th>
        <th>Thưởng KT+HCNS</th>
        <th>Media % trên tỉ suất</th>
        <th>Thưởng Media</th>
      </tr>
    </thead>
    <tbody>
      <!-- Facebook -->
      <tr class="channel-row">
        <td><input type="text" value="Facebook" /></td>
        <td><input type="number" class="rev" value="300000000" /></td>
        <td><input type="number" class="fixed" value="32000000" /></td>
        <td><input type="number" class="cpbh" value="14" /></td>
        <td><input type="number" class="cogs" value="55" /></td>
        <td><input type="number" class="cpk" value="5" /></td>
        <td class="varRate"></td>
        <td class="profit"></td>
        <td class="margin"></td>
        <td class="breakeven"></td>
        <td><input type="number" class="saleRateOnMargin" value="27" /></td>
        <td class="bonusSale"></td>
        <td><input type="number" class="rdRateOnMargin" value="4" /></td>
        <td class="bonusRD"></td>
        <td><input type="number" class="cskhRateOnMargin" value="1" /></td>
        <td class="bonusCSKH"></td>
        <td><input type="number" class="ktRateOnMargin" value="1.2" /></td>
        <td class="bonusKT"></td>
        <td><input type="number" class="mediaRateOnMargin" value="1" /></td>
        <td class="bonusMedia"></td>
      </tr>
      <!-- Tiktok -->
      <tr class="channel-row">
        <td><input type="text" value="Tiktok" /></td>
        <td><input type="number" class="rev" value="300000000" /></td>
        <td><input type="number" class="fixed" value="32000000" /></td>
        <td><input type="number" class="cpbh" value="27" /></td>
        <td><input type="number" class="cogs" value="45" /></td>
        <td><input type="number" class="cpk" value="5" /></td>
        <td class="varRate"></td>
        <td class="profit"></td>
        <td class="margin"></td>
        <td class="breakeven"></td>
        <td><input type="number" class="saleRateOnMargin" value="27" /></td>
        <td class="bonusSale"></td>
        <td><input type="number" class="rdRateOnMargin" value="4" /></td>
        <td class="bonusRD"></td>
        <td><input type="number" class="cskhRateOnMargin" value="1" /></td>
        <td class="bonusCSKH"></td>
        <td><input type="number" class="ktRateOnMargin" value="1.2" /></td>
        <td class="bonusKT"></td>
        <td><input type="number" class="mediaRateOnMargin" value="1" /></td>
        <td class="bonusMedia"></td>
      </tr>
      <!-- Shopee -->
      <tr class="channel-row">
        <td><input type="text" value="Shopee" /></td>
        <td><input type="number" class="rev" value="300000000" /></td>
        <td><input type="number" class="fixed" value="32000000" /></td>
        <td><input type="number" class="cpbh" value="18" /></td>
        <td><input type="number" class="cogs" value="55" /></td>
        <td><input type="number" class="cpk" value="5" /></td>
        <td class="varRate"></td>
        <td class="profit"></td>
        <td class="margin"></td>
        <td class="breakeven"></td>
        <td><input type="number" class="saleRateOnMargin" value="27" /></td>
        <td class="bonusSale"></td>
        <td><input type="number" class="rdRateOnMargin" value="4" /></td>
        <td class="bonusRD"></td>
        <td><input type="number" class="cskhRateOnMargin" value="1" /></td>
        <td class="bonusCSKH"></td>
        <td><input type="number" class="ktRateOnMargin" value="1.2" /></td>
        <td class="bonusKT"></td>
        <td><input type="number" class="mediaRateOnMargin" value="1" /></td>
        <td class="bonusMedia"></td>
      </tr>
      <!-- Web -->
      <tr class="channel-row">
        <td><input type="text" value="Web" /></td>
        <td><input type="number" class="rev" value="300000000" /></td>
        <td><input type="number" class="fixed" value="32000000" /></td>
        <td><input type="number" class="cpbh" value="18" /></td>
        <td><input type="number" class="cogs" value="55" /></td>
        <td><input type="number" class="cpk" value="5" /></td>
        <td class="varRate"></td>
        <td class="profit"></td>
        <td class="margin"></td>
        <td class="breakeven"></td>
        <td><input type="number" class="saleRateOnMargin" value="27" /></td>
        <td class="bonusSale"></td>
        <td><input type="number" class="rdRateOnMargin" value="4" /></td>
        <td class="bonusRD"></td>
        <td><input type="number" class="cskhRateOnMargin" value="1" /></td>
        <td class="bonusCSKH"></td>
        <td><input type="number" class="ktRateOnMargin" value="1.2" /></td>
        <td class="bonusKT"></td>
        <td><input type="number" class="mediaRateOnMargin" value="1" /></td>
        <td class="bonusMedia"></td>
      </tr>
    </tbody>
  </table>

  <h2>2. Thưởng hiệu quả RD theo kênh</h2>
  <p>Nhập chênh lệch hiệu quả và tỷ lệ thưởng (giống sheet "Thưởng hiệu quả RD").</p>

  <table id="rdTable">
    <thead>
      <tr>
        <th>Kênh</th>
        <th>Chênh lệch hiệu quả (VND)</th>
        <th>Tỉ lệ thưởng</th>
        <th>Thưởng tổng</th>
        <th>RD 60%</th>
        <th>Sale 25%</th>
        <th>CSKH 5%</th>
        <th>KT+HCNS 5%</th>
        <th>Media 5%</th>
      </tr>
    </thead>
    <tbody>
      <tr class="rd-row">
        <td><input type="text" value="Facebook" /></td>
        <td><input type="number" class="diff" value="20000000" /></td>
        <td><input type="number" class="rate" value="34" /></td>
        <td class="rdTotal"></td>
        <td class="rdRD"></td>
        <td class="rdSale"></td>
        <td class="rdCSKH"></td>
        <td class="rdKT"></td>
        <td class="rdMedia"></td>
      </tr>
      <tr class="rd-row">
        <td><input type="text" value="Tiktok" /></td>
        <td><input type="number" class="diff" value="20000000" /></td>
        <td><input type="number" class="rate" value="34" /></td>
        <td class="rdTotal"></td>
        <td class="rdRD"></td>
        <td class="rdSale"></td>
        <td class="rdCSKH"></td>
        <td class="rdKT"></td>
        <td class="rdMedia"></td>
      </tr>
      <tr class="rd-row">
        <td><input type="text" value="Shopee" /></td>
        <td><input type="number" class="diff" value="20000000" /></td>
        <td><input type="number" class="rate" value="14" /></td>
        <td class="rdTotal"></td>
        <td class="rdRD"></td>
        <td class="rdSale"></td>
        <td class="rdCSKH"></td>
        <td class="rdKT"></td>
        <td class="rdMedia"></td>
      </tr>
      <tr class="rd-row">
        <td><input type="text" value="Web" /></td>
        <td><input type="number" class="diff" value="20000000" /></td>
        <td><input type="number" class="rate" value="34" /></td>
        <td class="rdTotal"></td>
        <td class="rdRD"></td>
        <td class="rdSale"></td>
        <td class="rdCSKH"></td>
        <td class="rdKT"></td>
        <td class="rdMedia"></td>
      </tr>
    </tbody>
  </table>

  <h2>3. Tổng hợp thưởng theo bộ phận</h2>
  <table id="summaryTable">
    <thead>
      <tr>
        <th>Bộ phận</th>
        <th>Tổng thưởng từ bảng 1</th>
        <th>Tổng thưởng từ bảng 2</th>
        <th>Tổng cuối cùng</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Sale</td>
        <td id="sumSaleMain"></td>
        <td id="sumSaleRD"></td>
        <td id="sumSaleTotal"></td>
      </tr>
      <tr>
        <td>RD</td>
        <td id="sumRDMain"></td>
        <td id="sumRDRD"></td>
        <td id="sumRDTotal"></td>
      </tr>
      <tr>
        <td>CSKH</td>
        <td id="sumCSKHMain"></td>
        <td id="sumCSKHRD"></td>
        <td id="sumCSKHTotal"></td>
      </tr>
      <tr>
        <td>KT+HCNS</td>
        <td id="sumKTMain"></td>
        <td id="sumKTRD"></td>
        <td id="sumKTTotal"></td>
      </tr>
      <tr>
        <td>Media</td>
        <td id="sumMediaMain"></td>
        <td id="sumMediaRD"></td>
        <td id="sumMediaTotal"></td>
      </tr>
    </tbody>
  </table>

  <button class="btn" onclick="calculateAll()">Tính toán</button>

  <script>
    function fmtMoney(v) {
      if (!isFinite(v)) return '';
      return Math.round(v).toLocaleString('vi-VN');
    }
    function fmtPercent(v) {
      if (!isFinite(v)) return '';
      return (v * 100).toFixed(2) + '%';
    }

    function calculateMain() {
      const rows = document.querySelectorAll('#mainTable tbody .channel-row');
      let sumSale = 0, sumRD = 0, sumCSKH = 0, sumKT = 0, sumMedia = 0;

      rows.forEach(row => {
        const rev = Number(row.querySelector('.rev').value) || 0;
        const fixed = Number(row.querySelector('.fixed').value) || 0;
        const cpbh = (Number(row.querySelector('.cpbh').value) || 0) / 100;
        const cogs = (Number(row.querySelector('.cogs').value) || 0) / 100;
        const cpk  = (Number(row.querySelector('.cpk').value) || 0) / 100;

        const varRate = cpbh + cogs + cpk;
        const profit = rev * (1 - varRate) - fixed;
        const margin = rev > 0 ? profit / rev : 0;
        const breakeven = (1 - varRate) > 0 ? fixed / (1 - varRate) : 0;

        row.querySelector('.varRate').textContent = fmtPercent(varRate);
        row.querySelector('.profit').textContent = fmtMoney(profit);
        row.querySelector('.margin').textContent = fmtPercent(margin);
        row.querySelector('.breakeven').textContent = fmtMoney(breakeven);

        const saleRateOnMargin  = (Number(row.querySelector('.saleRateOnMargin').value)  || 0) / 100;
        const rdRateOnMargin    = (Number(row.querySelector('.rdRateOnMargin').value)    || 0) / 100;
        const cskhRateOnMargin  = (Number(row.querySelector('.cskhRateOnMargin').value)  || 0) / 100;
        const ktRateOnMargin    = (Number(row.querySelector('.ktRateOnMargin').value)    || 0) / 100;
        const mediaRateOnMargin = (Number(row.querySelector('.mediaRateOnMargin').value) || 0) / 100;

        const bonusSale  = rev * margin * saleRateOnMargin;
        const bonusRD    = rev * margin * rdRateOnMargin;
        const bonusCSKH  = rev * margin * cskhRateOnMargin;
        const bonusKT    = rev * margin * ktRateOnMargin;
        const bonusMedia = rev * margin * mediaRateOnMargin;

        row.querySelector('.bonusSale').textContent  = fmtMoney(bonusSale);
        row.querySelector('.bonusRD').textContent    = fmtMoney(bonusRD);
        row.querySelector('.bonusCSKH').textContent  = fmtMoney(bonusCSKH);
        row.querySelector('.bonusKT').textContent    = fmtMoney(bonusKT);
        row.querySelector('.bonusMedia').textContent = fmtMoney(bonusMedia);

        sumSale  += bonusSale;
        sumRD    += bonusRD;
        sumCSKH  += bonusCSKH;
        sumKT    += bonusKT;
        sumMedia += bonusMedia;
      });

      return { sumSale, sumRD, sumCSKH, sumKT, sumMedia };
    }

    function calculateRD() {
      const rows = document.querySelectorAll('#rdTable tbody .rd-row');
      let sumSale = 0, sumRD = 0, sumCSKH = 0, sumKT = 0, sumMedia = 0;

      rows.forEach(row => {
        const diff = Number(row.querySelector('.diff').value) || 0;
        const rate = (Number(row.querySelector('.rate').value) || 0) / 100;
        const total = diff * rate;

        const rd   = total * 0.60;
        const sale = total * 0.25;
        const cskh = total * 0.05;
        const kt   = total * 0.05;
        const media= total * 0.05;

        row.querySelector('.rdTotal').textContent = fmtMoney(total);
        row.querySelector('.rdRD').textContent    = fmtMoney(rd);
        row.querySelector('.rdSale').textContent  = fmtMoney(sale);
        row.querySelector('.rdCSKH').textContent  = fmtMoney(cskh);
        row.querySelector('.rdKT').textContent    = fmtMoney(kt);
        row.querySelector('.rdMedia').textContent = fmtMoney(media);

        sumSale  += sale;
        sumRD    += rd;
        sumCSKH  += cskh;
        sumKT    += kt;
        sumMedia += media;
      });

      return { sumSale, sumRD, sumCSKH, sumKT, sumMedia };
    }

    function calculateAll() {
      const main = calculateMain();
      const rd   = calculateRD();

      // Sale
      document.getElementById('sumSaleMain').textContent  = fmtMoney(main.sumSale);
      document.getElementById('sumSaleRD').textContent    = fmtMoney(rd.sumSale);
      document.getElementById('sumSaleTotal').textContent = fmtMoney(main.sumSale + rd.sumSale);

      // RD
      document.getElementById('sumRDMain').textContent    = fmtMoney(main.sumRD);
      document.getElementById('sumRDRD').textContent      = fmtMoney(rd.sumRD);
      document.getElementById('sumRDTotal').textContent   = fmtMoney(main.sumRD + rd.sumRD);

      // CSKH
      document.getElementById('sumCSKHMain').textContent  = fmtMoney(main.sumCSKH);
      document.getElementById('sumCSKHRD').textContent    = fmtMoney(rd.sumCSKH);
      document.getElementById('sumCSKHTotal').textContent = fmtMoney(main.sumCSKH + rd.sumCSKH);

      // KT+HCNS
      document.getElementById('sumKTMain').textContent    = fmtMoney(main.sumKT);
      document.getElementById('sumKTRD').textContent      = fmtMoney(rd.sumKT);
      document.getElementById('sumKTTotal').textContent   = fmtMoney(main.sumKT + rd.sumKT);

      // Media
      document.getElementById('sumMediaMain').textContent  = fmtMoney(main.sumMedia);
      document.getElementById('sumMediaRD').textContent    = fmtMoney(rd.sumMedia);
      document.getElementById('sumMediaTotal').textContent = fmtMoney(main.sumMedia + rd.sumMedia);
    }
  </script>
</body>
</html>
