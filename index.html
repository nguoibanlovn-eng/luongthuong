<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Phần mềm tính thưởng nhân sự theo kênh</title>
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #e5e7eb;
      color: #111827;
    }
    body {
      margin: 0;
      padding: 24px;
      max-width: 1200px;
      margin-inline: auto;
      background: #e5e7eb;
    }
    h1 {
      text-align: center;
      font-size: 26px;
      margin-bottom: 4px;
      font-weight: 650;
    }
    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 18px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 13px;
      cursor: pointer;
      font-weight: 500;
      transition: all .15s ease;
      background: #111827;
      color: #f9fafb;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      white-space: nowrap;
    }
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.18);
    }
    .btn-ghost {
      background: #f9fafb;
      color: #111827;
      border: 1px solid #d1d5db;
      box-shadow: none;
    }
    .btn-ghost:hover {
      background: #e5e7eb;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      gap: 18px;
      margin-bottom: 22px;
    }
    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 14px 14px 16px;
      box-shadow: 0 12px 30px rgba(15,23,42,0.12);
      border: 1px solid #e5e7eb;
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0.08;
      pointer-events: none;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
    }
    .card-title {
      font-size: 18px;
      font-weight: 650;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      color: #4b5563;
    }
    .card.tiktok::before      { background: radial-gradient(circle at top left, #06b6d4, transparent 55%); }
    .card.tiktok .card-title  { color: #0f766e; }
    .card.shopee::before      { background: radial-gradient(circle at top left, #fb923c, transparent 55%); }
    .card.shopee .card-title  { color: #c2410c; }
    .card.facebook::before    { background: radial-gradient(circle at top left, #60a5fa, transparent 55%); }
    .card.facebook .card-title{ color: #1d4ed8; }
    .card.web::before         { background: radial-gradient(circle at top left, #22c55e, transparent 55%); }
    .card.web .card-title     { color: #15803d; }
    .card.offline::before     { background: radial-gradient(circle at top left, #a855f7, transparent 55%); }
    .card.offline .card-title { color: #7c3aed; }

    .chip {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: .04em;
      background: #f9fafb;
    }

    .section {
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      padding: 10px 10px 12px;
      margin-bottom: 10px;
      background: #f9fafb;
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      gap: 8px;
    }
    .section-title { font-size: 13px; font-weight: 600; }
    .section-sub   { font-size: 11px; color: #6b7280; }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 12px;
      font-size: 12px;
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .field label {
      font-size: 11px;
      color: #6b7280;
    }
    .field-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    input[type="text"] {
      flex: 1;
      width: 100%;
      box-sizing: border-box;
      background: #f9fafb;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      padding: 5px 8px;
      font-size: 12px;
      color: #111827;
      outline: none;
    }
    input[type="text"]:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56,189,248,0.5);
      background: #ffffff;
    }
    .unit {
      font-size: 11px;
      color: #9ca3af;
      white-space: nowrap;
    }
    .value {
      font-size: 12px;
      font-weight: 500;
      color: #111827;
      white-space: nowrap;
    }
    .value.highlight { font-size: 13px; font-weight: 600; }
    .value.positive  { color: #16a34a; }
    .value.negative  { color: #dc2626; }

    .section-footer {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      margin-top: 6px;
      font-size: 11px;
      color: #6b7280;
      gap: 8px;
    }

    .summary-card {
      background: #ffffff;
      border-radius: 18px;
      padding: 14px 16px 16px;
      box-shadow: 0 12px 30px rgba(15,23,42,0.12);
      border: 1px solid #e5e7eb;
    }
    .summary-title { font-size: 15px; font-weight: 600; margin-bottom: 6px; }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      border-radius: 12px;
      overflow: hidden;
    }
    th, td {
      padding: 6px 8px;
      text-align: right;
      border-bottom: 1px solid #e5e7eb;
    }
    th:first-child, td:first-child { text-align: left; }
    th {
      background: #f3f4f6;
      font-weight: 600;
      color: #4b5563;
    }
    tbody tr:nth-child(odd) {
      background: #f9fafb;
    }
    tbody tr:hover {
      background: #e5e7eb;
    }
    tbody tr.total-row {
      background: #0f172a;
      color: #f9fafb;
      font-weight: 600;
    }
    tbody tr.total-row td {
      border-bottom: none;
    }
    .team-offline td:first-child { font-weight: 600; }

    @media (max-width: 768px) {
      body { padding: 16px; }
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <h1>Phần mềm tính thưởng theo kênh bán hàng</h1>
  <div class="subtitle">
    Mỗi kênh: 1) Hòa vốn  2) Doanh thu & chia thưởng. Dưới cùng là bảng tổng doanh thu & tổng thưởng.
  </div>

  <div class="cards">
    <!-- ===== KÊNH TIKTOK ===== -->
    <div class="card channel-card tiktok" data-channel="TikTok">
      <div class="card-header">
        <div class="card-title">
          TikTok
          <span class="badge">Kênh bán chính</span>
        </div>
        <button class="btn-ghost btn" onclick="calculateChannel(this)">Tính kênh TikTok</button>
      </div>

      <!-- 1. Hòa vốn -->
      <div class="section">
        <div class="section-header">
          <div>
            <div class="section-title">1. Điểm hòa vốn</div>
            <div class="section-sub">Từ chi phí cố định & các biến phí theo % doanh thu</div>
          </div>
          <span class="chip">Hòa vốn</span>
        </div>
        <div class="grid">
          <div class="field">
            <label>Chi phí cố định / tháng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-fixed js-money" value="32.000.000">
              <span class="unit">VND</span>
            </div>
            <label>Giá vốn hàng bán</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cogs" value="45">
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>CP bán hàng (phí sàn, ship, voucher...)</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cpbh" value="27">
              <span class="unit">% doanh thu</span>
            </div>
            <label>Chi phí khác</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cpk" value="5">
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>Tổng biến phí</label>
            <div class="field-row">
              <span class="value js-varRate">–</span>
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>Doanh thu hòa vốn ước tính</label>
            <div class="field-row">
              <span class="value highlight js-breakeven">–</span>
              <span class="unit">VND / tháng</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 2. Doanh thu & chia thưởng -->
      <div class="section">
        <div class="section-header">
          <div>
            <div class="section-title">2. Doanh thu & chia thưởng</div>
            <div class="section-sub">Lợi nhuận sau chi phí & thưởng theo % lợi nhuận</div>
          </div>
          <span class="chip">Thưởng</span>
        </div>

        <div class="grid">
          <!-- Cột trái -->
          <div class="field">
            <label>Doanh thu thực tế tháng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-rev js-money" value="300.000.000">
              <span class="unit">VND</span>
            </div>
            <label>Lợi nhuận sau chi phí</label>
            <div class="field-row">
              <span class="value highlight js-profit">–</span>
              <span class="unit">VND</span>
            </div>
            <label>Tỉ suất lợi nhuận</label>
            <div class="field-row">
              <span class="value js-margin">–</span>
              <span class="unit">% trên doanh thu</span>
            </div>
            <label>Tổng thưởng kênh</label>
            <div class="field-row">
              <span class="value highlight js-bonus-total">–</span>
              <span class="unit">VND</span>
            </div>
          </div>

          <!-- Cột phải: % & tiền thưởng ngay cạnh -->
          <div class="field">
            <label>% thưởng trên lợi nhuận (hiển thị tiền thưởng ngay bên cạnh)</label>

            <div class="field-row">
              <span class="unit">Sale</span>
              <input type="text" inputmode="decimal" class="js-rate-sale" value="27">
              <span class="unit">%</span>
              <span class="value js-bonus-sale-amt">–</span>
            </div>

            <div class="field-row">
              <span class="unit">RD</span>
              <input type="text" inputmode="decimal" class="js-rate-rd" value="4">
              <span class="unit">%</span>
              <span class="value js-bonus-rd-amt">–</span>
            </div>

            <div class="field-row">
              <span class="unit">CSKH</span>
              <input type="text" inputmode="decimal" class="js-rate-cskh" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-cskh-amt">–</span>
            </div>

            <div class="field-row">
              <span class="unit">KT + HCNS</span>
              <input type="text" inputmode="decimal" class="js-rate-kt" value="1,2">
              <span class="unit">%</span>
              <span class="value js-bonus-kt-amt">–</span>
            </div>

            <div class="field-row">
              <span class="unit">Media</span>
              <input type="text" inputmode="decimal" class="js-rate-media" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-media-amt">–</span>
            </div>

            <div class="field-row">
              <span class="unit">Website</span>
              <input type="text" inputmode="decimal" class="js-rate-web" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-web-amt">–</span>
            </div>

            <div class="field-row">
              <span class="unit">Offline</span>
              <input type="text" inputmode="decimal" class="js-rate-off" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-off-amt">–</span>
            </div>
          </div>
        </div>

        <div class="section-footer">
          <button class="btn-ghost btn" onclick="calculateChannel(this)">Cập nhật thưởng kênh TikTok</button>
        </div>
      </div>
    </div>

    <!-- ===== SHOPEE ===== -->
    <div class="card channel-card shopee" data-channel="Shopee">
      <div class="card-header">
        <div class="card-title">
          Shopee
          <span class="badge">Sàn TMĐT</span>
        </div>
        <button class="btn-ghost btn" onclick="calculateChannel(this)">Tính kênh Shopee</button>
      </div>

      <!-- Hòa vốn -->
      <div class="section">
        <div class="section-header">
          <div>
            <div class="section-title">1. Điểm hòa vốn</div>
            <div class="section-sub">Từ chi phí cố định & các biến phí theo % doanh thu</div>
          </div>
          <span class="chip">Hòa vốn</span>
        </div>
        <div class="grid">
          <div class="field">
            <label>Chi phí cố định / tháng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-fixed js-money" value="32.000.000">
              <span class="unit">VND</span>
            </div>
            <label>Giá vốn hàng bán</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cogs" value="55">
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>CP bán hàng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cpbh" value="18">
              <span class="unit">% doanh thu</span>
            </div>
            <label>Chi phí khác</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cpk" value="5">
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>Tổng biến phí</label>
            <div class="field-row">
              <span class="value js-varRate">–</span>
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>Doanh thu hòa vốn ước tính</label>
            <div class="field-row">
              <span class="value highlight js-breakeven">–</span>
              <span class="unit">VND / tháng</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Doanh thu & thưởng -->
      <div class="section">
        <div class="section-header">
          <div>
            <div class="section-title">2. Doanh thu & chia thưởng</div>
            <div class="section-sub">Lợi nhuận sau chi phí & thưởng theo % lợi nhuận</div>
          </div>
          <span class="chip">Thưởng</span>
        </div>

        <div class="grid">
          <div class="field">
            <label>Doanh thu thực tế tháng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-rev js-money" value="300.000.000">
              <span class="unit">VND</span>
            </div>
            <label>Lợi nhuận sau chi phí</label>
            <div class="field-row">
              <span class="value highlight js-profit">–</span>
              <span class="unit">VND</span>
            </div>
            <label>Tỉ suất lợi nhuận</label>
            <div class="field-row">
              <span class="value js-margin">–</span>
              <span class="unit">% trên doanh thu</span>
            </div>
            <label>Tổng thưởng kênh</label>
            <div class="field-row">
              <span class="value highlight js-bonus-total">–</span>
              <span class="unit">VND</span>
            </div>
          </div>

          <div class="field">
            <label>% thưởng trên lợi nhuận</label>

            <div class="field-row">
              <span class="unit">Sale</span>
              <input type="text" inputmode="decimal" class="js-rate-sale" value="27">
              <span class="unit">%</span>
              <span class="value js-bonus-sale-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">RD</span>
              <input type="text" inputmode="decimal" class="js-rate-rd" value="4">
              <span class="unit">%</span>
              <span class="value js-bonus-rd-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">CSKH</span>
              <input type="text" inputmode="decimal" class="js-rate-cskh" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-cskh-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">KT + HCNS</span>
              <input type="text" inputmode="decimal" class="js-rate-kt" value="1,2">
              <span class="unit">%</span>
              <span class="value js-bonus-kt-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">Media</span>
              <input type="text" inputmode="decimal" class="js-rate-media" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-media-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">Website</span>
              <input type="text" inputmode="decimal" class="js-rate-web" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-web-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">Offline</span>
              <input type="text" inputmode="decimal" class="js-rate-off" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-off-amt">–</span>
            </div>
          </div>
        </div>

        <div class="section-footer">
          <button class="btn-ghost btn" onclick="calculateChannel(this)">Cập nhật thưởng kênh Shopee</button>
        </div>
      </div>
    </div>

    <!-- ===== FACEBOOK ===== -->
    <div class="card channel-card facebook" data-channel="Facebook">
      <div class="card-header">
        <div class="card-title">
          Facebook
          <span class="badge">Paid & Page</span>
        </div>
        <button class="btn-ghost btn" onclick="calculateChannel(this)">Tính kênh Facebook</button>
      </div>

      <!-- Hòa vốn -->
      <div class="section">
        <div class="section-header">
          <div>
            <div class="section-title">1. Điểm hòa vốn</div>
            <div class="section-sub">Từ chi phí cố định & các biến phí theo % doanh thu</div>
          </div>
          <span class="chip">Hòa vốn</span>
        </div>
        <div class="grid">
          <div class="field">
            <label>Chi phí cố định / tháng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-fixed js-money" value="32.000.000">
              <span class="unit">VND</span>
            </div>
            <label>Giá vốn hàng bán</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cogs" value="55">
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>CP bán hàng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cpbh" value="14">
              <span class="unit">% doanh thu</span>
            </div>
            <label>Chi phí khác</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cpk" value="5">
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>Tổng biến phí</label>
            <div class="field-row">
              <span class="value js-varRate">–</span>
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>Doanh thu hòa vốn ước tính</label>
            <div class="field-row">
              <span class="value highlight js-breakeven">–</span>
              <span class="unit">VND / tháng</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Doanh thu & thưởng -->
      <div class="section">
        <div class="section-header">
          <div>
            <div class="section-title">2. Doanh thu & chia thưởng</div>
            <div class="section-sub">Lợi nhuận sau chi phí & thưởng theo % lợi nhuận</div>
          </div>
          <span class="chip">Thưởng</span>
        </div>

        <div class="grid">
          <div class="field">
            <label>Doanh thu thực tế tháng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-rev js-money" value="300.000.000">
              <span class="unit">VND</span>
            </div>
            <label>Lợi nhuận sau chi phí</label>
            <div class="field-row">
              <span class="value highlight js-profit">–</span>
              <span class="unit">VND</span>
            </div>
            <label>Tỉ suất lợi nhuận</label>
            <div class="field-row">
              <span class="value js-margin">–</span>
              <span class="unit">% trên doanh thu</span>
            </div>
            <label>Tổng thưởng kênh</label>
            <div class="field-row">
              <span class="value highlight js-bonus-total">–</span>
              <span class="unit">VND</span>
            </div>
          </div>

          <div class="field">
            <label>% thưởng trên lợi nhuận</label>

            <div class="field-row">
              <span class="unit">Sale</span>
              <input type="text" inputmode="decimal" class="js-rate-sale" value="27">
              <span class="unit">%</span>
              <span class="value js-bonus-sale-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">RD</span>
              <input type="text" inputmode="decimal" class="js-rate-rd" value="4">
              <span class="unit">%</span>
              <span class="value js-bonus-rd-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">CSKH</span>
              <input type="text" inputmode="decimal" class="js-rate-cskh" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-cskh-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">KT + HCNS</span>
              <input type="text" inputmode="decimal" class="js-rate-kt" value="1,2">
              <span class="unit">%</span>
              <span class="value js-bonus-kt-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">Media</span>
              <input type="text" inputmode="decimal" class="js-rate-media" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-media-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">Website</span>
              <input type="text" inputmode="decimal" class="js-rate-web" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-web-amt">–</span>
            </div>
            <div class="field-row">
              <span class="unit">Offline</span>
              <input type="text" inputmode="decimal" class="js-rate-off" value="1">
              <span class="unit">%</span>
              <span class="value js-bonus-off-amt">–</span>
            </div>
          </div>
        </div>

        <div class="section-footer">
          <button class="btn-ghost btn" onclick="calculateChannel(this)">Cập nhật thưởng kênh Facebook</button>
        </div>
      </div>
    </div>

    <!-- ===== WEBSITE ===== -->
    <div class="card channel-card web" data-channel="Website">
      <div class="card-header">
        <div class="card-title">
          Website
          <span class="badge">Kênh web</span>
        </div>
        <button class="btn-ghost btn" onclick="calculateChannel(this)">Tính kênh Website</button>
      </div>

      <!-- Hòa vốn -->
      <div class="section">
        <div class="section-header">
          <div>
            <div class="section-title">1. Điểm hòa vốn</div>
            <div class="section-sub">Từ chi phí cố định & các biến phí theo % doanh thu</div>
          </div>
          <span class="chip">Hòa vốn</span>
        </div>
        <div class="grid">
          <div class="field">
            <label>Chi phí cố định / tháng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-fixed js-money" value="20.000.000">
              <span class="unit">VND</span>
            </div>
            <label>Giá vốn hàng bán</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cogs" value="50">
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>CP bán hàng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cpbh" value="15">
              <span class="unit">% doanh thu</span>
            </div>
            <label>Chi phí khác</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cpk" value="5">
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>Tổng biến phí</label>
            <div class="field-row">
              <span class="value js-varRate">–</span>
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>Doanh thu hòa vốn ước tính</label>
            <div class="field-row">
              <span class="value highlight js-breakeven">–</span>
              <span class="unit">VND / tháng</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Doanh thu & thưởng -->
      <div class="section">
        <div class="section-header">
          <div>
            <div class="section-title">2. Doanh thu & chia thưởng</div>
            <div class="section-sub">Lợi nhuận sau chi phí & thưởng theo % lợi nhuận</div>
          </div>
          <span class="chip">Thưởng</span>
        </div>

        <div class="grid">
          <div class="field">
            <label>Doanh thu thực tế tháng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-rev js-money" value="200.000.000">
              <span class="unit">VND</span>
            </div>
            <label>Lợi nhuận sau chi phí</label>
            <div class="field-row">
              <span class="value highlight js-profit">–</span>
              <span class="unit">VND</span>
            </div>
            <label>Tỉ suất lợi nhuận</label>
            <div class="field-row">
              <span class="value js-margin">–</span>
              <span class="unit">% trên doanh thu</span>
            </div>
            <label>Tổng thưởng kênh</label>
            <div class="field-row">
              <span class="value highlight js-bonus-total">–</span>
              <span class="unit">VND</span>
            </div>
          </div>

          <div class="field">
            <label>% thưởng trên lợi nhuận</label>
            <div class="field-row"><span class="unit">Sale</span>   <input type="text" inputmode="decimal" class="js-rate-sale"  value="27"><span class="unit">%</span><span class="value js-bonus-sale-amt">–</span></div>
            <div class="field-row"><span class="unit">RD</span>     <input type="text" inputmode="decimal" class="js-rate-rd"    value="4"><span class="unit">%</span><span class="value js-bonus-rd-amt">–</span></div>
            <div class="field-row"><span class="unit">CSKH</span>   <input type="text" inputmode="decimal" class="js-rate-cskh"  value="1"><span class="unit">%</span><span class="value js-bonus-cskh-amt">–</span></div>
            <div class="field-row"><span class="unit">KT + HCNS</span><input type="text" inputmode="decimal" class="js-rate-kt" value="1,2"><span class="unit">%</span><span class="value js-bonus-kt-amt">–</span></div>
            <div class="field-row"><span class="unit">Media</span>  <input type="text" inputmode="decimal" class="js-rate-media" value="1"><span class="unit">%</span><span class="value js-bonus-media-amt">–</span></div>
            <div class="field-row"><span class="unit">Website</span><input type="text" inputmode="decimal" class="js-rate-web"   value="1"><span class="unit">%</span><span class="value js-bonus-web-amt">–</span></div>
            <div class="field-row"><span class="unit">Offline</span><input type="text" inputmode="decimal" class="js-rate-off"   value="1"><span class="unit">%</span><span class="value js-bonus-off-amt">–</span></div>
          </div>
        </div>

        <div class="section-footer">
          <button class="btn-ghost btn" onclick="calculateChannel(this)">Cập nhật thưởng kênh Website</button>
        </div>
      </div>
    </div>

    <!-- ===== OFFLINE ===== -->
    <div class="card channel-card offline" data-channel="Offline">
      <div class="card-header">
        <div class="card-title">
          Offline
          <span class="badge">Cửa hàng / sự kiện</span>
        </div>
        <button class="btn-ghost btn" onclick="calculateChannel(this)">Tính kênh Offline</button>
      </div>

      <!-- Hòa vốn -->
      <div class="section">
        <div class="section-header">
          <div>
            <div class="section-title">1. Điểm hòa vốn</div>
            <div class="section-sub">Từ chi phí cố định & các biến phí theo % doanh thu</div>
          </div>
          <span class="chip">Hòa vốn</span>
        </div>
        <div class="grid">
          <div class="field">
            <label>Chi phí cố định / tháng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-fixed js-money" value="25.000.000">
              <span class="unit">VND</span>
            </div>
            <label>Giá vốn hàng bán</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cogs" value="50">
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>CP bán hàng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cpbh" value="20">
              <span class="unit">% doanh thu</span>
            </div>
            <label>Chi phí khác</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-cpk" value="5">
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>Tổng biến phí</label>
            <div class="field-row">
              <span class="value js-varRate">–</span>
              <span class="unit">% doanh thu</span>
            </div>
          </div>
          <div class="field">
            <label>Doanh thu hòa vốn ước tính</label>
            <div class="field-row">
              <span class="value highlight js-breakeven">–</span>
              <span class="unit">VND / tháng</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Doanh thu & thưởng -->
      <div class="section">
        <div class="section-header">
          <div>
            <div class="section-title">2. Doanh thu & chia thưởng</div>
            <div class="section-sub">Lợi nhuận sau chi phí & thưởng theo % lợi nhuận</div>
          </div>
          <span class="chip">Thưởng</span>
        </div>

        <div class="grid">
          <div class="field">
            <label>Doanh thu thực tế tháng</label>
            <div class="field-row">
              <input type="text" inputmode="decimal" class="js-rev js-money" value="150.000.000">
              <span class="unit">VND</span>
            </div>
            <label>Lợi nhuận sau chi phí</label>
            <div class="field-row">
              <span class="value highlight js-profit">–</span>
              <span class="unit">VND</span>
            </div>
            <label>Tỉ suất lợi nhuận</label>
            <div class="field-row">
              <span class="value js-margin">–</span>
              <span class="unit">% trên doanh thu</span>
            </div>
            <label>Tổng thưởng kênh</label>
            <div class="field-row">
              <span class="value highlight js-bonus-total">–</span>
              <span class="unit">VND</span>
            </div>
          </div>

          <div class="field">
            <label>% thưởng trên lợi nhuận</label>
            <div class="field-row"><span class="unit">Sale</span>   <input type="text" inputmode="decimal" class="js-rate-sale"  value="27"><span class="unit">%</span><span class="value js-bonus-sale-amt">–</span></div>
            <div class="field-row"><span class="unit">RD</span>     <input type="text" inputmode="decimal" class="js-rate-rd"    value="4"><span class="unit">%</span><span class="value js-bonus-rd-amt">–</span></div>
            <div class="field-row"><span class="unit">CSKH</span>   <input type="text" inputmode="decimal" class="js-rate-cskh"  value="1"><span class="unit">%</span><span class="value js-bonus-cskh-amt">–</span></div>
            <div class="field-row"><span class="unit">KT + HCNS</span><input type="text" inputmode="decimal" class="js-rate-kt" value="1,2"><span class="unit">%</span><span class="value js-bonus-kt-amt">–</span></div>
            <div class="field-row"><span class="unit">Media</span>  <input type="text" inputmode="decimal" class="js-rate-media" value="1"><span class="unit">%</span><span class="value js-bonus-media-amt">–</span></div>
            <div class="field-row"><span class="unit">Website</span><input type="text" inputmode="decimal" class="js-rate-web"   value="1"><span class="unit">%</span><span class="value js-bonus-web-amt">–</span></div>
            <div class="field-row"><span class="unit">Offline</span><input type="text" inputmode="decimal" class="js-rate-off"   value="1"><span class="unit">%</span><span class="value js-bonus-off-amt">–</span></div>
          </div>
        </div>

        <div class="section-footer">
          <button class="btn-ghost btn" onclick="calculateChannel(this)">Cập nhật thưởng kênh Offline</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== CARD TỔNG ===== -->
  <div class="summary-card">
    <div class="section" style="margin-bottom:10px;">
      <div class="section-header">
        <div>
          <div class="summary-title">Bảng tổng doanh thu & tổng thưởng</div>
          <div class="section-sub">Tổng hợp nhanh hiệu quả theo từng kênh</div>
        </div>
        <button class="btn" onclick="calculateAllChannels()">Tính tất cả kênh & cập nhật bảng tổng</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Kênh</th>
            <th>Doanh thu</th>
            <th>Lợi nhuận</th>
            <th>Tỉ suất LN</th>
            <th>Tổng thưởng</th>
          </tr>
        </thead>
        <tbody id="summary-body"></tbody>
      </table>
    </div>

    <div class="section">
      <div class="section-header">
        <div>
          <div class="summary-title">Tổng thưởng theo bộ phận (mọi kênh)</div>
          <div class="section-sub">Cộng gộp thưởng từ tất cả nền tảng, sắp xếp từ cao xuống thấp</div>
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th>Bộ phận</th>
            <th>Tổng thưởng</th>
          </tr>
        </thead>
        <tbody id="summary-team-body"></tbody>
      </table>
    </div>
  </div>

  <script>
    // Đọc số từ input có thể chứa . ngăn cách nghìn và , làm dấu thập phân
    function parseNumber(el) {
      if (!el) return 0;
      const raw = (el.value || '').toString().trim();
      if (!raw) return 0;
      const cleaned = raw.replace(/\s/g, '').replace(/\./g, '').replace(',', '.');
      const num = parseFloat(cleaned);
      return isNaN(num) ? 0 : num;
    }
    function fmtMoney(v) {
      if (!isFinite(v)) return '–';
      return Math.round(v).toLocaleString('vi-VN');
    }
    function fmtPercent(v) {
      if (!isFinite(v)) return '–';
      return (v * 100).toFixed(2) + '%';
    }

    function calculateChannel(btn) {
      const card = btn.closest('.channel-card');
      if (!card) return;

      // Hòa vốn
      const fixed = parseNumber(card.querySelector('.js-fixed'));
      const cpbh  = parseNumber(card.querySelector('.js-cpbh')) / 100;
      const cogs  = parseNumber(card.querySelector('.js-cogs')) / 100;
      const cpk   = parseNumber(card.querySelector('.js-cpk'))  / 100;

      const varRate = cpbh + cogs + cpk;
      const varRateEl   = card.querySelector('.js-varRate');
      const breakevenEl = card.querySelector('.js-breakeven');

      if (varRateEl)   varRateEl.textContent   = fmtPercent(varRate);
      let breakeven = 0;
      if (1 - varRate > 0) breakeven = fixed / (1 - varRate);
      if (breakevenEl) breakevenEl.textContent = fmtMoney(breakeven);

      // Doanh thu & lợi nhuận
      const rev = parseNumber(card.querySelector('.js-rev'));
      const profitEl = card.querySelector('.js-profit');
      const marginEl = card.querySelector('.js-margin');

      let profit = rev * (1 - varRate) - fixed;
      let margin = rev > 0 ? profit / rev : 0;

      if (profitEl) {
        profitEl.textContent = fmtMoney(profit);
        profitEl.classList.toggle('positive', profit > 0);
        profitEl.classList.toggle('negative', profit < 0);
      }
      if (marginEl) marginEl.textContent = fmtPercent(margin);

      const baseProfit = Math.max(profit, 0); // lỗ thì không thưởng

      // % thưởng
      const rateSale  = parseNumber(card.querySelector('.js-rate-sale'))  / 100;
      const rateRD    = parseNumber(card.querySelector('.js-rate-rd'))    / 100;
      const rateCSKH  = parseNumber(card.querySelector('.js-rate-cskh'))  / 100;
      const rateKT    = parseNumber(card.querySelector('.js-rate-kt'))    / 100;
      const rateMedia = parseNumber(card.querySelector('.js-rate-media')) / 100;
      const rateWeb   = parseNumber(card.querySelector('.js-rate-web'))   / 100;
      const rateOff   = parseNumber(card.querySelector('.js-rate-off'))   / 100;

      const bonusSale  = baseProfit * rateSale;
      const bonusRD    = baseProfit * rateRD;
      const bonusCSKH  = baseProfit * rateCSKH;
      const bonusKT    = baseProfit * rateKT;
      const bonusMedia = baseProfit * rateMedia;
      const bonusWeb   = baseProfit * rateWeb;
      const bonusOff   = baseProfit * rateOff;

      const bonusTotal = bonusSale + bonusRD + bonusCSKH + bonusKT + bonusMedia + bonusWeb + bonusOff;

      function setBonus(selectorAmount, bonus) {
        const a = card.querySelector(selectorAmount);
        if (a) a.textContent = fmtMoney(bonus);
      }
      setBonus('.js-bonus-sale-amt',  bonusSale);
      setBonus('.js-bonus-rd-amt',    bonusRD);
      setBonus('.js-bonus-cskh-amt',  bonusCSKH);
      setBonus('.js-bonus-kt-amt',    bonusKT);
      setBonus('.js-bonus-media-amt', bonusMedia);
      setBonus('.js-bonus-web-amt',   bonusWeb);
      setBonus('.js-bonus-off-amt',   bonusOff);

      const totalEl = card.querySelector('.js-bonus-total');
      if (totalEl) totalEl.textContent = fmtMoney(bonusTotal);

      // Lưu cho bảng tổng
      card.dataset.rev        = rev;
      card.dataset.profit     = profit;
      card.dataset.margin     = margin;
      card.dataset.bonusTotal = bonusTotal;
      card.dataset.bonusSale  = bonusSale;
      card.dataset.bonusRd    = bonusRD;
      card.dataset.bonusCskh  = bonusCSKH;
      card.dataset.bonusKt    = bonusKT;
      card.dataset.bonusMedia = bonusMedia;
      card.dataset.bonusWeb   = bonusWeb;
      card.dataset.bonusOff   = bonusOff;

      updateSummary();
    }

    function calculateAllChannels() {
      document.querySelectorAll('.channel-card').forEach(card => {
        const btn = card.querySelector('.btn-ghost');
        if (btn) calculateChannel(btn);
      });
    }

    function updateSummary() {
      const cards = document.querySelectorAll('.channel-card');
      const tbody = document.getElementById('summary-body');
      const tTeam = document.getElementById('summary-team-body');
      if (!tbody || !tTeam) return;

      tbody.innerHTML = '';
      tTeam.innerHTML = '';

      let totalRev = 0, totalProfit = 0, totalBonus = 0;
      let sumSale = 0, sumRD = 0, sumCSKH = 0, sumKT = 0, sumMedia = 0, sumWeb = 0, sumOff = 0;

      cards.forEach(card => {
        const name   = card.dataset.channel || 'Kênh';
        const rev    = Number(card.dataset.rev        || 0);
        const profit = Number(card.dataset.profit     || 0);
        const margin = Number(card.dataset.margin     || 0);
        const bonus  = Number(card.dataset.bonusTotal || 0);

        if (rev === 0 && profit === 0 && bonus === 0) return;

        totalRev    += rev;
        totalProfit += profit;
        totalBonus  += bonus;

        sumSale  += Number(card.dataset.bonusSale  || 0);
        sumRD    += Number(card.dataset.bonusRd    || 0);
        sumCSKH  += Number(card.dataset.bonusCskh  || 0);
        sumKT    += Number(card.dataset.bonusKt    || 0);
        sumMedia += Number(card.dataset.bonusMedia || 0);
        sumWeb   += Number(card.dataset.bonusWeb   || 0);
        sumOff   += Number(card.dataset.bonusOff   || 0);

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${name}</td>
          <td>${fmtMoney(rev)}</td>
          <td>${fmtMoney(profit)}</td>
          <td>${fmtPercent(margin)}</td>
          <td>${fmtMoney(bonus)}</td>
        `;
        tbody.appendChild(tr);
      });

      const trTotal = document.createElement('tr');
      trTotal.className = 'total-row';
      const totalMargin = totalRev > 0 ? totalProfit / totalRev : 0;
      trTotal.innerHTML = `
        <td>Tổng</td>
        <td>${fmtMoney(totalRev)}</td>
        <td>${fmtMoney(totalProfit)}</td>
        <td>${fmtPercent(totalMargin)}</td>
        <td>${fmtMoney(totalBonus)}</td>
      `;
      tbody.appendChild(trTotal);

      // Tổng theo bộ phận: sort giảm dần
      const teamTotals = [
        { name: 'Sale',      value: sumSale },
        { name: 'RD',        value: sumRD },
        { name: 'CSKH',      value: sumCSKH },
        { name: 'KT + HCNS', value: sumKT },
        { name: 'Media',     value: sumMedia },
        { name: 'Website',   value: sumWeb },
        { name: 'Offline',   value: sumOff }
      ].sort((a, b) => b.value - a.value);

      teamTotals.forEach(t => {
        const tr = document.createElement('tr');
        if (t.name === 'Offline') tr.className = 'team-offline';
        tr.innerHTML = `<td>${t.name}</td><td>${fmtMoney(t.value)}</td>`;
        tTeam.appendChild(tr);
      });
    }

    function formatMoneyInput(el) {
      const num = parseNumber(el);
      if (!num) {
        if (!el.value) return;
        el.value = '';
        return;
      }
      el.value = Math.round(num).toLocaleString('vi-VN');
    }

    window.addEventListener('DOMContentLoaded', () => {
      // Format sẵn các input tiền
      document.querySelectorAll('.js-money').forEach(el => {
        formatMoneyInput(el);
        el.addEventListener('blur', () => formatMoneyInput(el));
      });
      calculateAllChannels();
    });
  </script>
</body>
</html>
